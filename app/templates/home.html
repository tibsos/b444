{% load static %}
{% load compress %}
{% load custom_filters %}

<!DOCTYPE html>

<html>

    <head>

        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Щиток</title>
        <meta name="description" content="Щиток">

        <link rel="icon" type="image/png" href="{% static 'logo.png' %}">

        <script src="{% static 'packages/jquery-3.6.1.min.js' %}"></script>
        <script src="{% static 'packages/htmx.min.js' %}"></script>
        <script src="{% static 'packages/iconify.min.js' %}"></script>

        {% compress css %}

            <link rel="stylesheet" href="{% static 'scss/app/home.scss' %}" type="text/x-scss">

        {% endcompress %}

    </head>
    
    <body>

        <div class="everything">

            <!-- Profile dropdown btn -->
            <div class="profile-dropdown">

                <div class="buttons">

                    <a href="#">

                        <div class="btn" id="myAccount">

                            <svg style="left: 15px;" xmlns="http://www.w3.org/2000/svg" width="23.339" height="23.34" viewBox="0 0 23.339 23.34">
                                <path id="Icon_ionic-ios-person" data-name="Icon ionic-ios-person" d="M27.828,27.251c-.438-1.933-2.936-2.875-3.8-3.179a28.323,28.323,0,0,0-3.167-.608,3.218,3.218,0,0,1-1.465-.675,12.8,12.8,0,0,1-.1-3,9.016,9.016,0,0,0,.693-1.319,17.013,17.013,0,0,0,.511-2.3s.5,0,.675-.875a8.612,8.612,0,0,0,.45-2.036c-.036-.7-.419-.681-.419-.681a10.657,10.657,0,0,0,.413-3.118c.055-2.5-1.9-4.96-5.446-4.96-3.592,0-5.507,2.462-5.452,4.96a11.116,11.116,0,0,0,.407,3.118s-.383-.018-.419.681a8.612,8.612,0,0,0,.45,2.036c.17.875.675.875.675.875a17.013,17.013,0,0,0,.511,2.3,9.016,9.016,0,0,0,.693,1.319,12.8,12.8,0,0,1-.1,3,3.218,3.218,0,0,1-1.465.675,28.323,28.323,0,0,0-3.167.608c-.863.3-3.361,1.246-3.8,3.179a.486.486,0,0,0,.48.59H27.354A.485.485,0,0,0,27.828,27.251Z" transform="translate(-4.501 -4.5)"/>
                            </svg>
        
                            <span>Мой аккаунт</span>
                        
                        </div>

                    </a>

                    <a href="/contact" target='_blank'>

                        <div class="btn" id="myAccount">

                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" version="1.1" id="Layer_1" viewBox="0 0 24 24" xml:space="preserve">
                                <style type="text/css">
                                    .st0{fill:none;}
                                </style>
                                <g id="surface1">
                                    <path d="M12,2v7.1c1.2,0.4,2,1.5,2,2.8c0,0.5-0.1,1-0.4,1.4l2,1.6c0.1,0,0.2-0.1,0.4-0.1c0.6,0,1,0.4,1,1c0,0.6-0.4,1-1,1   c-0.6,0-1-0.4-1-1v-0.1l-2-1.6c-0.5,0.5-1.2,0.8-2,0.8c-1.7,0-3-1.3-3-3c0-1.3,0.8-2.4,2-2.8v-7H9.9C6.4,2.5,3.5,5.4,3.1,9   c-0.3,2.2,0.3,4.2,1.5,5.8C5.5,16,6,17.3,6,18.8V22h9v-3h2c1.1,0,2-0.9,2-2v-3l1.5-0.6c0.4-0.2,0.6-0.8,0.4-1.2l-1.9-3   C18.6,5.5,15.7,2.5,12,2z M11,10.5c-0.8,0-1.5,0.7-1.5,1.5s0.7,1.5,1.5,1.5s1.5-0.7,1.5-1.5S11.8,10.5,11,10.5z"/>
                                </g>
                                <rect class="st0" width="24" height="24"/>
                                </svg>
        
                            <span>Поддержка</span>
                        
                        </div>

                    </a>

                    <a href="/logout">

                        <div class="btn no-margin" id="logout">

                            <svg style="fill: red;" xmlns="http://www.w3.org/2000/svg" width="28.618" height="27.77" viewBox="0 0 28.618 27.77">
                                <path id="Icon_open-account-logout" data-name="Icon open-account-logout" d="M9.606-1.086c-4,.8-3.2,2.4,0,3.2s9.606-4,12.808,0,3.2,12.007,0,16.01-9.606-.8-12.808,0-4,2.4,0,3.2,12.007,5.6,16.01,0,4-16.81,0-22.414S13.608-1.886,9.606-1.086Zm-3.2,6.4c-1.6.4-6.4,2.4-6.4,4.8s4.8,4.4,6.4,4.8,0-3.2,0-3.2,9.606.8,12.808,0,3.2-2.4,0-3.2S6.4,8.52,6.4,8.52,8,4.918,6.4,5.318Z" transform="translate(0 3.764)"/>
                            </svg>
        
                            <span style="color: red;">Выйти</span>
                        
                        </div>

                    </a>

                </div>

            </div>

            <!-- Account details form -->
            <div class="account-preferences">

                <div class="wrapper">

                    <div id="closeAccountPreferences">×</div>

                    <span class="form-title">Мой аккаунт</span>

                    <div class="fields">

                        <!-- Email -->
                        <div id="profileEmail" class="field">

                            <svg class='field-icon' id="accountEmail" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" viewBox="0 0 35 35">
                                <defs>
                                  <clipPath id="clip-Пользовательский_размер_1">
                                    <rect width="35" height="35"/>
                                  </clipPath>
                                </defs>
                                <g id="Пользовательский_размер_1" data-name="Пользовательский размер – 1" clip-path="url(#clip-Пользовательский_размер_1)">
                                  <rect width="35" height="35" fill="none"/>
                                  <g id="Icon_feather-mail" data-name="Icon feather-mail" transform="translate(-0.891 0.157)">
                                    <path id="Контур_3" data-name="Контур 3" d="M6.078,6H30.7a3.046,3.046,0,0,1,3.078,2.994V26.958A3.046,3.046,0,0,1,30.7,29.952H6.078A3.046,3.046,0,0,1,3,26.958V8.994A3.046,3.046,0,0,1,6.078,6Z" transform="translate(0)" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M33.782,9,18.391,18.973,3,9" transform="translate(0 -0.151)" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                                  </g>
                                </g>
                            </svg>

                            <input 
                                type="text"
                                id="profileEmailVal"
                                value="{{ user.username }}"
                                placeholder="Почта" />

                            <svg id="emailError" class="error" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" " role="img" aria-label="Warning Icon "><title>Warning Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.999756C4.13401 0.999756 1 4.13376 1 7.99976C1 11.8657 4.13401 14.9998 8 14.9998C11.866 14.9998 15 11.8657 15 7.99976C15 4.13376 11.866 0.999756 8 0.999756ZM0 7.99976C0 3.58148 3.58172 -0.000244141 8 -0.000244141C12.4183 -0.000244141 16 3.58148 16 7.99976C16 12.418 12.4183 15.9998 8 15.9998C3.58172 15.9998 0 12.418 0 7.99976ZM7.5 8.99951V3.99999H8.5V8.99951H7.5ZM9 11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55228 10 9 10.4477 9 11Z" fill="currentColor"></path></svg>
                            <svg id="emailOK" class="ok" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" text-carnation" role="img" aria-label="Complete Tick Icon "><title>Complete Tick Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.99854C4.13401 0.99854 1 4.13254 1 7.99854C1 11.8645 4.13401 14.9985 8 14.9985C11.866 14.9985 15 11.8645 15 7.99854C15 4.13254 11.866 0.99854 8 0.99854ZM0 7.99854C0 3.58026 3.58172 -0.00146484 8 -0.00146484C12.4183 -0.00146484 16 3.58026 16 7.99854C16 12.4168 12.4183 15.9985 8 15.9985C3.58172 15.9985 0 12.4168 0 7.99854Z" fill="green"></path><path d="M7.5 10.4985L7.14645 10.8521L7.92183 10.767L7.5 10.4985ZM4.64645 8.35209L7.14645 10.8521L7.85355 10.145L5.35355 7.64498L4.64645 8.35209ZM7.92183 10.767L11.4218 5.26697L10.5782 4.7301L7.07817 10.2301L7.92183 10.767Z" fill="green"></path></svg>

                        </div>

                        <!-- Password -->
                        <div id="profilePassword" class="field">

                            <svg class='field-icon' id="accountPassword" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" viewBox="0 0 35 35">
                                <defs>
                                  <clipPath id="clip-Пользовательский_размер_1">
                                    <rect width="35" height="35"/>
                                  </clipPath>
                                </defs>
                                <g id="Пользовательский_размер_1" data-name="Пользовательский размер – 1" clip-path="url(#clip-Пользовательский_размер_1)">
                                  <rect width="35" height="35" fill="none"/>
                                  <path id="Icon_ionic-ios-lock" data-name="Icon ionic-ios-lock" d="M30.072,15.369h-2v-3.89a8,8,0,1,0-15.992-.108v4h-2A3.341,3.341,0,0,0,6.75,18.7V34.693a3.341,3.341,0,0,0,3.332,3.332h19.99A3.341,3.341,0,0,0,33.4,34.693V18.7A3.341,3.341,0,0,0,30.072,15.369ZM21.243,25.764v5.731a1.194,1.194,0,0,1-1.108,1.2,1.167,1.167,0,0,1-1.224-1.166V25.764a2.665,2.665,0,1,1,2.332,0Zm4.5-10.395H14.413v-4a5.664,5.664,0,0,1,11.328,0Z" transform="translate(-2.577 -3.2)"/>
                                </g>
                            </svg> 

                            <input 
                                type="text"
                                id="profilePasswordVal"
                                placeholder="Новый пароль" />

                            <svg id="passwordError" class="error" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" " role="img" aria-label="Warning Icon "><title>Warning Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.999756C4.13401 0.999756 1 4.13376 1 7.99976C1 11.8657 4.13401 14.9998 8 14.9998C11.866 14.9998 15 11.8657 15 7.99976C15 4.13376 11.866 0.999756 8 0.999756ZM0 7.99976C0 3.58148 3.58172 -0.000244141 8 -0.000244141C12.4183 -0.000244141 16 3.58148 16 7.99976C16 12.418 12.4183 15.9998 8 15.9998C3.58172 15.9998 0 12.418 0 7.99976ZM7.5 8.99951V3.99999H8.5V8.99951H7.5ZM9 11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55228 10 9 10.4477 9 11Z" fill="currentColor"></path></svg>
                            <svg id="passwordOK" class="ok" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=" text-carnation" role="img" aria-label="Complete Tick Icon "><title>Complete Tick Icon</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.99854C4.13401 0.99854 1 4.13254 1 7.99854C1 11.8645 4.13401 14.9985 8 14.9985C11.866 14.9985 15 11.8645 15 7.99854C15 4.13254 11.866 0.99854 8 0.99854ZM0 7.99854C0 3.58026 3.58172 -0.00146484 8 -0.00146484C12.4183 -0.00146484 16 3.58026 16 7.99854C16 12.4168 12.4183 15.9985 8 15.9985C3.58172 15.9985 0 12.4168 0 7.99854Z" fill="green"></path><path d="M7.5 10.4985L7.14645 10.8521L7.92183 10.767L7.5 10.4985ZM4.64645 8.35209L7.14645 10.8521L7.85355 10.145L5.35355 7.64498L4.64645 8.35209ZM7.92183 10.767L11.4218 5.26697L10.5782 4.7301L7.07817 10.2301L7.92183 10.767Z" fill="green"></path></svg>

                        </div>

                    </div>

                </div>

            </div>         

            <!-- TopNav -->
            <div class="topnav">

                <div class="topnav-wrapper">

                    <div class="toggle-sidenav">

                        <div id="toggleSidenavBtn">
    
                            <svg xmlns="http://www.w3.org/2000/svg" width="19.394" height="28.21" viewBox="0 0 19.394 28.21">
                                <path id="Icon_awesome-lightbulb" data-name="Icon awesome-lightbulb" d="M5.293,25.033a1.764,1.764,0,0,0,.3.975l.942,1.415A1.763,1.763,0,0,0,8,28.21h3.4a1.763,1.763,0,0,0,1.468-.787l.942-1.415a1.762,1.762,0,0,0,.3-.975l0-2.113H5.29l0,2.113ZM0,9.7a9.643,9.643,0,0,0,2.4,6.379,15.834,15.834,0,0,1,2.877,5.039c0,.014.006.043.006.043h8.829c0-.014,0-.028.006-.043a15.834,15.834,0,0,1,2.877-5.039A9.7,9.7,0,1,0,0,9.7ZM9.7,5.289A4.413,4.413,0,0,0,5.289,9.7a.882.882,0,0,1-1.763,0A6.178,6.178,0,0,1,9.7,3.526a.882.882,0,0,1,0,1.763Z" transform="translate(0 0)"></path>
                            </svg>
    
                        </div>
    
                    </div>
    
                    <!-- Search form -->
                    <div class="search-notes">
    
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="23.835" height="23.841" viewBox="0 0 23.835 23.841">
                            <path id="Icon_ionic-ios-search" data-name="Icon ionic-ios-search" d="M4.78,26.609l6.629-6.691a9.447,9.447,0,1,1,1.434,1.452L6.257,28.018a1.02,1.02,0,0,1-1.44.037A1.027,1.027,0,0,1,4.78,26.609ZM18.832,21.45a7.46,7.46,0,1,0-5.276-2.185A7.414,7.414,0,0,0,18.832,21.45Z" transform="translate(-4.5 -4.493)"/>
                        </svg>
    
                        <form>
    
                            <!-- Folder query -->
                            <input 
                                type="text" 
                                name="f" 
                                class="folderSearch"
                                hidden />
    
                            <!-- Note title/content query -->
                            <input 
                                type="text"
                                id="noteSearch" 
                                name="q" 
                                placeholder="Искать пароль">
    
                            <!-- Note section queries -->
    
                                <!-- Loved -->
                            <input 
                                type="checkbox" 
                                name="l" 
                                class="loved-search"
                                hidden />
    
                                <!-- Archived -->
                            <input 
                                type="checkbox" 
                                name="a" 
                                class="archive-search"
                                hidden />
    
                                <!-- Trash search -->
                            <input 
                                type="checkbox" 
                                name="t" 
                                class="trash-search"
                                hidden />
                                
                        </form>
    
                        <form>
    
                            <!-- Folder query -->
                            <input 
                                type="text" 
                                name="f" 
                                class="folderSearch"
                                hidden />
                        
                            <!-- Note section queries -->
    
                                <!-- Loved -->
                            <input 
                                type="checkbox" 
                                name="l" 
                                class="loved-search"
                                hidden />
    
                                <!-- Archived -->
                            <input 
                                type="checkbox" 
                                name="a" 
                                class="archive-search"
                                hidden />
    
                                <!-- Trash search -->
                            <input 
                                type="checkbox" 
                                name="t" 
                                class="trash-search"
                                hidden />
    
                            <button id="cancelSearch">×</button>
                        
                        </form>
    
                    </div>
    
                    <!-- Light/dark mode btn -->
                    <div class="mode">
    
                        <label class="toggle-mode">

                            {% if profile.dark_mode %}
                            
                                <input class='toggle-checkbox' id="modeCB" type='checkbox' checked></input>
    
                                <script>
    
                                    $('body').addClass('dark');
    
                                </script>
    
                            {% else %}
    
                                <input class='toggle-checkbox' id="modeCB" type='checkbox'></input>
    
                            {% endif %}

                            <div class='toggle-slot'>
                            <div class='sun-icon-wrapper'>
                                <div class="iconify sun-icon" data-icon="feather-sun" data-inline="false"></div>
                            </div>
                            <div class='toggle-button'></div>
                            <div class='moon-icon-wrapper'>
                                <div class="iconify moon-icon" data-icon="feather-moon" data-inline="false"></div>
                            </div>
                            </div>

                        </label>
    
                    </div>
    
                    <div class="profile">
    
                        <div class="initials">
    
                            <span>{{ user.username|slice:":1"|upper }}</span>
    
                        </div>
    
                    </div>

                </div>

            </div>

            <!-- Notes -->
            <div class="passwords">

                <div class="first-password">

                    <span class="warn-text">Сейф пуст 🗄️</span>
                    <span class="cta-text">Засекреть свой первый пароль 🔒</span>
                    <button class="cta-btn">Создать пароль</button>
            
                </div>

                <div id="passwordList">

                    {% include 'components/passwords.html' %}

                </div>

            </div>

            <div id="addPasswordBtn">+</div>

            <div id="firstPasswordForm">

                <div class="wrapper">

                    <div id="closeNewPasswordForm">×</div>

                    <span id="newPasswordHeading">Новый пароль</span>

                    <div id="newPasswordForm">

                        <form hx-post="/cp" hx-target="#passwordList">

                            <input 
                            name="u" 
                            type="text" 
                            id="newPasswordURL" 
                            placeholder="Ссылка">

                            <input 
                                name='n' 
                                type="text" 
                                id="newPasswordName" 
                                placeholder="Заголовок">

                            <input 
                                name='l' 
                                type="text" 
                                id="newPasswordLogin" 
                                placeholder="Логин">

                            <input 
                                name='p' 
                                type="password" 
                                id="newPasswordPassword" 
                                placeholder="Пароль">

                            <textarea 
                                name="t" 
                                id="newPasswordText" 
                                cols="45" 
                                rows="10"
                                placeholder="Записка..."></textarea>

                            <button type="submit" id="createNewPassword">Создать</button>

                        </form>

                    </div>

                </div>

            </div>

        </div>

    </body>
    
    <!-- Password -->
    <script>

        if ($('#passwordList').children().length === 0) {

            $('.first-password').css('display', 'flex');

        }

        $('.cta-btn, .add-password').click(function() {

            $('.first-password').hide();

        });

        $('#createNewPassword').click(function() {

            $('#firstPasswordForm').animate({

                'opacity': 0,

            }, 250);

            setTimeout(function() {

                $('#firstPasswordForm').hide();

            }, 250);

        });

        $('.password-action').click(function() {

            btn = $(this);

            btn.addClass('in');

            setTimeout(function() {

                btn.removeClass('in');

            }, 250);

        });

        function copyToClipboard(text) {
            // Create a temporary textarea element
            var textarea = document.createElement('textarea');
            // Set the value of the textarea to the text you want to copy
            textarea.value = text;
            // Append the textarea to the document body
            document.body.appendChild(textarea);
            // Select the text inside the textarea
            textarea.select();
            // Execute the copy command
            document.execCommand('copy');
            // Remove the textarea from the document body
            document.body.removeChild(textarea);
        
        }

        $('.copyPassword').click(function() {

            password = $(this).siblings('input:first').attr('class');
            copyToClipboard(password);

        });

        $('.deletePassword').click(function() {

            uid = $(this).siblings('input:first').attr('id');

            $.ajax({

                type: 'POST',
                
                url: '/dp',

                data: {

                    'csrfmiddlewaretoken': "{{ csrf_token }}",
                    'i': uid,

                }

            });

            $(this).parent().parent().remove();

            if ($('#passwordList').children().length === 0) {

                $('.first-password').css('display', 'flex');

            }

        });

        $('.cta-btn, #addPasswordBtn').click(function() {

            $('#firstPasswordForm').css('display', 'flex');
            $('#firstPasswordForm').animate({

                'opacity': 1,

            }, 250);

            $('#newPasswordURL').focus();

            $(this).addClass('in');

            setTimeout(function() {

                $('.cta-btn').removeClass('in');

            }, 250);

        });

        $('#closeNewPasswordForm').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('#closeNewPasswordForm').removeClass('active');

            }, 250);

            $('#firstPasswordForm').animate({

                'opacity': 0,

            }, 250);
            
            setTimeout(function() {

                $('#firstPasswordForm').hide();

            }, 250);

        });

    </script>

    <style>

        @font-face {

            font-family: Comfortaa;
            src: url("{% static 'fonts/Comfortaa.ttf' %}");

        }

        @font-face {

            font-family: SG;
            src: url("{% static 'fonts/ShowcardGothic.otf' %}");
        
        }

    </style>

    <!-- Anal -->        
    <script>

        $(window).on('load', function() {

            
            $.ajax({ 
                
                type: 'POST',

                url: "{% url 'analytics:funnel' %}",
                
                data: {
                    
                    'csrfmiddlewaretoken': "{{ csrf_token }}",
                    
                }
                
            });

        });

    </script>

    <!-- universal -->
    <script>

        document.body.addEventListener('htmx:configRequest', (event) => {

            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';

        });

        function delay(callback, ms) {

            var timer = 0;

            return function() {

                var context = this, args = arguments;
                clearTimeout(timer);
                
                timer = setTimeout(function () {

                    callback.apply(context, args);

                }, ms || 0);

            };
            
        };

        function validateEmail(e) {

            var re = /\S+@\S+\.\S+/;
            return re.test(e);

        }

        function hasNumber(myString) {

            return /\d/.test(myString);
        
        }

    </script>

    <!-- Tasks -->

    <script>

        $('#tasksSection').click(function() {

            $('.new-note').hide();
            $('.notes').hide();
            $('.new-task').css('display', 'flex');

        });

    </script>

    <!-- First note cta -->

    <script>

        if ($('.note-section').children('.note').length == 0) {

            $('.first-note').css('display', 'flex');
            $('.note-section-title').hide();

        };
        
        $('.cta-btn').click(function() {

            $('.new-note-title').focus();

            $('.first-note').hide();

        });

    </script>

    <!-- Mode -->
    <script>

        $('#modeCB').change(function() {

            $('body').toggleClass('dark')

            $.ajax({

                type: 'POST',

                url: "{% url 'user:toggle-mode' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                }

            });

        });

    </script>

    <!-- Profile -->
    <script>

        /* Dropdown */

        profileDropdownOpen = false;
        
        $('.profile').click(function() {

            $('.initials').toggleClass('active');

            if (profileDropdownOpen) {

                $('.profile-dropdown').animate({'opacity': 0}, 250);

                setTimeout(function() {

                    $('.profile-dropdown').hide();

                }, 250);

                profileDropdownOpen = false;

            } else {

                $('.profile-dropdown').show();
                $('.profile-dropdown').animate({'opacity': 1}, 250);

                profileDropdownOpen = true;

            }

        });

        /* Button & dropdown animation */

        $('#myAccount, #logout, #subscription').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.btn').removeClass('active');

            }, 250);

                /* Hide profile dropdown */
            $('.initials').removeClass('active');

            $('.profile-dropdown').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.profile-dropdown').hide();

            }, 250);

            profileDropdownOpen = false;

        });

        /* Account preferences */

        accountFormOpen = false;

            /* Form render */
        $('#myAccount').click(function() {

            accountFormOpen = true;

            $('.account-preferences').css('display', 'flex');
            $('.account-preferences').animate({

                'opacity': 1,

            }, 250);

            oldName = $('#profileNameVal').val();
            oldEmail = $('#profileEmailVal').val();

        });

            /* Close form */
        $('#closeAccountPreferences').click(function() {

            accountFormOpen = false;

            $('#closeAccountPreferences').addClass('active');

            $('.account-preferences').animate({

                'opacity': 0,

            }, 250);

            setTimeout(function() {

                $('#closeAccountPreferences').removeClass('active');

                $('.account-preferences').hide();

                $('#emailError').hide();
                $('#nameError').hide();
                $('#passwordError').hide();
                $('#profilePasswordVal').val('');

            }, 250);

        });

            /* Field logic */

        /* Name */
        document.getElementById('profileNameVal').addEventListener('input', function() {

            $('#nameError').hide();
            $('#nameOK').hide();

        });

        document.getElementById('profileNameVal').addEventListener('input', delay(function() {

            if (!$('#profileNameVal').val()) {

                $('#nameError').show();

            } else {

                $('#nameOK').show();

                setTimeout(function() {

                    $('#nameOK').hide();

                }, 1500);

                newName = $('#profileNameVal').val();

                if (newName != oldName) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'user:cn' %}",

                        data: {

                            'csrfmiddlewaretoken': "{{ csrf_token }}",
                            'n': newName,

                        }

                    });

                }

            }
            
        }, 750));

        /* Email */
        document.getElementById('profileEmailVal').addEventListener('input', function() {

            $('#emailError').hide();
            $('#emailOK').hide();

        });

        document.getElementById('profileEmailVal').addEventListener('input', delay(function() {

            newEmail = $('#profileEmailVal').val();

            if (!validateEmail(newEmail)) {

                $('#emailError').show();

            } else {

                $('#emailOK').show();

                setTimeout(function() {

                    $('#emailOK').hide();

                }, 1500);

                if (newEmail != oldEmail) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'user:cu' %}",

                        data: {

                            'csrfmiddlewaretoken': "{{ csrf_token }}",
                            'e': newEmail,

                        }

                    });

                }

            }
            
        }, 750));

        /* Password */

        document.getElementById('profilePasswordVal').addEventListener('input', function() {

            $('#passwordError').hide();
            $('#passwordOK').hide();

        });

        document.getElementById('profilePasswordVal').addEventListener('input', delay(function() {

            newPassword = $('#profilePasswordVal').val();

            if (newPassword.length < 7 || !hasNumber(newPassword)) {

                $('#passwordError').show();

            } else {
                
                $('#passwordOK').show();

                setTimeout(function() {

                    $('#passwordOK').hide();

                }, 1500);


                $.ajax({

                    type: 'POST',

                    url: "{% url 'user:cp' %}",

                    data: {

                        'csrfmiddlewaretoken': "{{ csrf_token }}",
                        'p': newPassword,

                    }

                });

            }
            
        }, 750));

        /* Subscription  */

            /* Render form */
        $('#subscription').click(function() {

            subFormOpen = true;

            $('.subscription-info').css('display', 'flex');
            $('.subscription-info').animate({

                'opacity': 1,

            }, 250);

        });

            /* Close form */
        $('#closeSubInfo').click(function() {

            subFormOpen = false;

            $('#closeSubInfo').addClass('active');

            $('.subscription-info').animate({

                'opacity': 0,

            }, 250);

            setTimeout(function() {

                $('#closeSubInfo').removeClass('active');

                $('.subscription-info').hide();


            }, 250);

        });

        /* Cancel sub */

        $('#cancelSub').click(function() {
            
            $('.cancel-subscription-confirmation').css('display', 'flex');
            $('.cancel-subscription-confirmation').animate({

                opacity: 1,

            }, 250);

        });

        $('#cancelSubConfirmation, #cancelSubBtn').click(function() {

            $('.cancel-subscription-confirmation').animate({

                opacity: 0,

            }, 250);

            setTimeout(function() {

                $('.cancel-subscription-confirmation').hide();

            }, 250)

        });

        $('#cancelSubBtn').click(function() {

            alert('Подписка отменена успешно.');

            $('.subscription-info, #subscription    ').hide();

            $.ajax({

                type: 'POST',
                
                url: "{% url 'user:cancel-sub' %}",

                data: {

                    'csrfmiddlewaretoken': "{{ csrf_token }}"

                }

            })

        });

    </script>

    <!-- Pop-ups -->

    <script>

    <!-- Search notes -->
    <script>

        /* Change placeholder depending on device width */

        if ($(window).width() <= 775) {

            $('#noteSearch').attr('placeholder', 'Искать');

        } else {

            $('#noteSearch').attr('placeholder', 'Искать пароль');

        }

        $(window).resize(function() {

            if ($(window).width() <= 775) {

                $('#noteSearch').attr('placeholder', 'Искать');

            } else {

                $('#noteSearch').attr('placeholder', 'Искать пароль');

            }

        });

        document.getElementById('noteSearch').addEventListener('input', function() {

            $('#cancelSearch').show();
            $('#cancelSearch').animate({'opacity': 1}, 250);

        }, false);

        $('body').on('click', '#cancelSearch', function() {

            $('#noteSearch').val('');
            $(this).animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('#cancelSearch').hide();

            }, 250)   

        });

    </script>

    <!-- Close forms when ESC has been clicked -->
    <script>

        $('body').click(function(e) {

            if (noteOpen && $(e.target).is('.current-note')) {

                closeNote();

            }

        });

        $('body').keyup(function(e) {

            if (e.keyCode === 27) {

                if (window.opener && window.opener !== window) { /* We're in a pop-up */

                    console.log('p');

                } else {

                    if (folderFormShown) {

                        folderFormShown = false;

                        $('.create-folder').animate({'opacity': 0}, 250);

                        setTimeout(function() {
            
                            $('.create-folder').css('display', 'none');
            
                        }, 250);

                    } else if (accountFormOpen) {

                        $('.account-preferences').animate({

                            'opacity': 0,

                        }, 250);

                        setTimeout(function() {

                            $('#emailError').hide();
                            $('#nameError').hide();
                            $('#passwordError').hide();
                            $('#profilePasswordVal').val('');

                            $('#closeAccountPreferences').removeClass('active');

                            $('.account-preferences').hide();

                        }, 250);

                    } else if (editFolderFormShown) {

                        editFolderFormShown = false;

                        $('.edit-folder-btn').removeClass('active');

                        $('.edit-folder').animate({'opacity': 0}, 250);

                        setTimeout(function() {

                            $('.edit-folder').css('display', 'none');

                        }, 250);

                    } else if (noteOpen && !photoOpen && !folderSearchOpen) {

                        closeNote();

                    } else if (folderSearchOpen && !photoOpen) {

                        closeFolderSearch();

                    } else {

                        closePhotoCarousel();
                        photoOpen = false;

                    }

                }

            }

        });

    </script>

</html>